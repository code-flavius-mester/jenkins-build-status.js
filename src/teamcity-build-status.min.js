!function(t){t.fn.teamCityBuildStatus=function(t){return this.each(function(){new n(this,t)})};var n=function(n,i){function s(){o.getAll(function(t){t.forEach(r.create)})}var c="project",u=t("<div>").attr("id",i.projectId).addClass(c).appendTo(n),o=new a(i),r=new e(u,this,i);this.showFailure=function(){u.prop("class",c).addClass("failed")},s()},a=function(n){var a="/guestAuth/app/rest/projects/id:";this.getAll=function(e){t.ajax({url:n.teamcityUrl+a+n.projectId,headers:{accept:"application/json"},success:function(t){e(t.buildTypes.buildType)}})}},e=function(t,n,a){this.create=function(e){return new i(n,{projectElement:t,teamcityUrl:a.teamcityUrl,id:e.id,name:e.name})}},i=function(n,a){function e(){var n=t("<span>").addClass("name").text(a.name);c=t("<div>").attr("id",a.id).addClass(u).append(n).appendTo(a.projectElement)}function i(){t.ajax({url:o,headers:{accept:"application/json"},success:function(t){t.build.length>0&&s(t.build[0])}})}function s(t){c.prop("class",u).addClass(r[t.status]).toggleClass("running",!!t.running),"FAILURE"===t.status&&n.showFailure()}var c,u="build-stage",o=a.teamcityUrl+"/guestAuth/app/rest/builds?locator=buildType:(id:"+a.id+"),lookupLimit:10,running:any",r={FAILURE:"failed",SUCCESS:"success"};e(),i()}}(jQuery);